var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,g,e){d instanceof String&&(d=String(d));for(var f=d.length,a=0;a<f;a++){var b=d[a];if(g.call(e,b,a,d))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,g,e){d!=Array.prototype&&d!=Object.prototype&&(d[g]=e.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,g,e,f){if(g){e=$jscomp.global;d=d.split(".");for(f=0;f<d.length-1;f++){var a=d[f];a in e||(e[a]={});e=e[a]}d=d[d.length-1];f=e[d];g=g(f);g!=f&&null!=g&&$jscomp.defineProperty(e,d,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,e){return $jscomp.findInternal(this,d,e).v}},"es6","es3");
!function(d,g,e,f){XF.InlineMod=XF.Element.newHandler({options:{type:null,href:null,searchTarget:null,cookieBase:"inlinemod",toggle:"input[type=checkbox].js-inlineModToggle",toggleContainer:".js-inlineModContainer",containerClass:"is-mod-selected",actionTrigger:".js-inlineModTrigger",counter:".js-inlineModCounter",viewport:"body"},cookie:null,$action:null,xhr:null,$searchTarget:null,init:function(){if(this.options.type){this.options.href||console.error("No inline mod href specified");var a=this.options.searchTarget;
if("*"===a)var b=d(e);else a&&a.length?(b=XF.findRelativeIf(a,this.$target),b.length||(console.error("Search target %s not found, falling back to children",a),b=this.$target)):b=this.$target;this.$searchTarget=b;this.cookie=this.options.cookieBase+"_"+this.options.type;b.on("click",this.options.toggle,XF.proxy(this,"onToggle"));b.on("click",this.options.actionTrigger,XF.proxy(this,"onActionTrigger"));a=this.getCookieValue();this._initialLoad(a);this._updateCounter(a.length);var c=this;setTimeout(function(){d(e).on("xf:reinit",
function(a,b){c.$searchTarget.has(b)&&d(b).find(c.options.toggle).length&&c.recalculateFromCookie()})},0)}else console.error("No inline mod type specified")},_initialLoad:function(a){var b=this.getToggles();b.each(function(){d(this).prop("checked",!1)});var c={};if(a.length){b.each(function(){var a=d(this);c[a.val()]=a});b=a.length;for(var h,e=0;e<b;e++)h=a[e],c[h]&&(c[h].prop("checked",!0),this.toggleContainer(c[h],!0))}},getToggles:function(){return this.$searchTarget.find(this.options.toggle)},
recalculateFromCookie:function(){for(var a=this.getCookieValue(),b=a.length,c={},h=this,e=0;e<b;e++)c[a[e]]=!0;this.getToggles().each(function(){var a=d(this),b=a.is(":checked"),e=c[a.val()]?!0:!1;b&&!e?(a.prop("checked",!1),h.toggleContainer(a,!1)):!b&&e&&(a.prop("checked",!0),h.toggleContainer(a,!0))})},deselect:function(){this.setCookieValue([]);this.recalculateFromCookie();this.hideBar()},selectAll:function(){var a=this.getCookieValue();this.getToggles().each(function(){var b=parseInt(d(this).val(),
10);-1===d.inArray(b,a)&&a.push(b)});this.setCookieValue(a);this.recalculateFromCookie();return a},deselectPage:function(){var a=this.getCookieValue(),b=[],c=[];this.getToggles().each(function(){c.push(parseInt(d(this).val(),10))});for(var e=0;e<a.length;e++)-1===d.inArray(a[e],c)&&b.push(a[e]);this.setCookieValue(b);this.recalculateFromCookie();b.length?this.loadBar():this.hideBar();return b},onToggle:function(a){a=d(a.target);var b=a.is(":checked");var c=this.toggleSelectedInCookie(a.val(),b);this.toggleContainer(a,
b);c.length?this.loadBar():this.hideBar()},onActionTrigger:function(a){a.preventDefault();this.loadBar()},loadBar:function(a){var b=this;this.loadTimeout&&clearTimeout(this.loadTimeout);this.loadTimeout=setTimeout(function(){b.xhr&&b.xhr.abort();b.xhr=XF.ajax("GET",b.options.href,{type:b.options.type},function(c){b._showBar(c,a)})},10)},_showBar:function(a,b){this.xhr=null;if(a.html){var c=this;XF.setupHtmlInsert(a.html,function(a,e,g){e=!1;c.$bar&&(e=!0,c.$bar.remove(),c.$bar=null);c._setupBar(a);
c.$bar=a;XF.bottomFix(a);if(XF.browser.ios){var h=d('<div class="inlineModBarCover" />'),f=c.$bar,k=f.find(".js-inlineModAction");h.click(function(){k.blur()});k.on({focus:function(){f.before(h)},blur:function(){setTimeout(function(){h.remove()},200)}})}e&&a.css("transition-duration","0s");a.addClassTransitioned("is-active");e&&setTimeout(function(){a.css("transition-duration","")},0);b&&b(a)})}},_setupBar:function(a){a.on("click",":submit",XF.proxy(this,"submit")).on("click",".js-inlineModClose",
XF.proxy(this,"hideBar")).on("click",".js-inlineModSelectAll",XF.proxy(this,"onSelectAllClick"));var b=this.getToggles();b.length==b.filter(":checked").length&&a.find("input[type=checkbox].js-inlineModSelectAll").prop("checked",!0)},onSelectAllClick:function(a){d(a.target).is(":checked")?this.selectAll().length?this.loadBar(function(a){a.find("input[type=checkbox].js-inlineModSelectAll").prop("checked",!0)}):this.deselect():this.deselectPage()},submit:function(){if(this.$bar){var a=this.$bar.find(".js-inlineModAction");
if(a.length){if(a=a.val())if("deselect"==a)this.deselect();else{var b=this;XF.ajax("POST",this.options.href,{type:this.options.type,action:a},function(a){b._handleSubmitResponse(a)},{skipDefaultSuccess:!0})}}else console.error("No action selector found.")}},_handleSubmitResponse:function(a){a.html?XF.setupHtmlInsert(a.html,function(a,c){a=XF.getOverlayHtml({html:a,title:c.h1||c.title});XF.showOverlay(a)}):"ok"==a.status&&a.redirect?a.message?XF.flashMessage(a.message,1E3,function(){XF.redirect(a.redirect)}):
XF.redirect(a.redirect):XF.alert("Unexpected response");this.hideBar()},hideBar:function(){if(this.$bar){var a=this;this.$bar.removeClassTransitioned("is-active",function(){a.$bar&&a.$bar.remove();a.$bar=null})}},_updateCounter:function(a){var b=this.$searchTarget.find(this.options.actionTrigger),c=b.find(".inlineModButton");c.length||(c=b);c.toggleClass("is-mod-active",0<a);this.$searchTarget.find(this.options.counter).text(a)},toggleContainer:function(a,b){b=b?"addClass":"removeClass";a.closest(this.options.toggleContainer)[b](this.options.containerClass)},
toggleSelectedInCookie:function(a,b){a=parseInt(a,10);var c=this.getCookieValue(),e=d.inArray(a,c),f=!1;b?0>e&&(c.push(a),f=!0):0<=e&&(c.splice(e,1),f=!0);return f?this.setCookieValue(c):c},getCookieValue:function(){var a=XF.Cookie.get(this.cookie);if(!a)return[];a=a.split(",");for(var b=a.length,c=0;c<b;c++)a[c]=parseInt(a[c],10);return a},setCookieValue:function(a){a.length?(a.sort(function(a,c){return a-c}),XF.Cookie.set(this.cookie,a.join(","))):XF.Cookie.remove(this.cookie);this._updateCounter(a.length);
return a}});XF.Element.register("inline-mod","XF.InlineMod")}(jQuery,window,document);
